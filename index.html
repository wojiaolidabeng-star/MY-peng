<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æåŒ»ç”Ÿæ•°å­—è¯Šå®¤ Â· æå®¢æµ‹è¯•ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jose/4.14.4/index.umd.min.js"></script>
    <script src="https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.2.0-beta.19/libs/cn/index.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; display: flex; }
        .left-poster { width: 80%; height: 100%; overflow: hidden; border-right: 1px solid rgba(255,255,255,0.1); }
        .left-poster img { width: 100%; height: 100%; object-fit: cover; object-position: 75% center; opacity: 0.8; }
        .coze-web-sdk-bubble-icon { display: none !important; }
        .coze-web-sdk-container { right: 20px !important; bottom: 20px !important; z-index: 1000 !important; }
    </style>
</head>
<body>
    <div class="left-poster">
        <img src="https://images.unsplash.com/photo-1629909613654-28e377c37b09?q=80&w=2070&auto=format&fit=crop" alt="è¯Šå®¤é¢„è§ˆ">
    </div>

    <script>
        // ==========================================
        // ğŸ” æ ¸å¿ƒé…ç½®ï¼ˆä»…é™æµ‹è¯•ï¼Œå…¬ç§é’¥å·²æ³¨å…¥ï¼‰
        // ==========================================
        const COZE_CONFIG = {
            appId: "98413940235942673107639473050914.app.coze", // ä½ çš„ App ID
            kid: "Lz_Ovr855eHfMWrxvaSoas97mnDfXakqemD2LWmTnmc",    // ä½ çš„å…¬é’¥ ID
            // ä½ çš„ RSA ç§é’¥
            privateKeyPem: `-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDENzcVeH36ImNL
8DkoXUJzyR2bkqSVkdutszpjmBH4ZT8MwTXKp8iS8LFatIXXeDqvhtK3kwm22kwx
WjZaC2I7/c8QQQRiD9+yZRr128s61To1iGwXG1rE1HIUnypuoJmfxOXEfcyoYGRK
7Z/zL1Kc6DmE/kL4MKUXaGP2/YFdYOhqlkUEcVQ3H0/4XUvQ99hpQp/zFnFJ6x+g
ykQKc4+LmCggPnZkagYT4oZgmhA9rT/5xYF4T4WE4p5ZXy1Qqe7uhbaMM4CxfXR4
6s4MvcUoJyckSn7TH/lZXqmpSjScezDbg/W/DW9zT1yrrAKtkB53VKp5l1kXBRF2
jpCf0zhVAgMBAAECggEAA9v/9+qxpz62ApUdxrFSgInRsx221SAakk4FBYorVlFF
fkGubKDd66TGbd3A1GL8XB36g8GL+1FlYylRvULEKQc3vRHbHUOpkOFD671dDLhY
QTVm+auTa21jT6XTm5WKMZyMyWkRCLUAQmhuN2x0aa4rc9x3CQzJ5OefSbxYQLPB
rKuc87IwZQUYenayFNntfDCw08fqZeM0ONVdj9LYGNTWyQOIrO1M9XS8OV+rvZdj
AmjC13n58F/iS8AFpTjjlcNowgwyfgH44cxlsQFtFdsc4DySTgF1QuY2bLfoTPSm
bywBrjJuKhMLShUwSpko2s2JyFucsNnffi5wT0SdEQKBgQDwd00BqjkBB2EACd4O
Y4CRlL87XJ0uYfoveLdKPAmILZVDMMUxFaUSZvhuIRdM9YkCYq5glEUsgImfDW5y
ACxe6g+SfVOMzNiEN4D7pmqwV+qGpOdBA56Pf7/O0sD9cdmyZq78c91EUhaed8r0
x0xWD20ocZzD4zMV6QzMrgmGEQKBgQDQ5CA4BU1eN3sMU+e9+CnYy2cKNmJtUMeP
C6/08+r2ioT4pUEwe5ZVlPcG+nhNzMxU/E+CeSwiwCAa++wqNiPQzxH0dpcoztr/
krZzvQm2PFfEx/wh18ZF8UdKBpRzxn+nvXXTeG0Yblg8z+aAPl8jif6lsJkDT7C/
sfFl3kf6BQKBgCTsPJ/H0m7tAiDuYvFUp/Yyn9Zulxf7JV5Kq+IzK8eEMEob3/t0
dl9H/ldyr1A612nNWzcrLR/zMK6CcnYAvs9oIzH8GmshPRG4MA7z86fWKAW6pmOe
OaeRFxOb2tRPufyhtba/17bY3+4/OKOzQm5oeftezpJpfXucyEFZa87xAoGBAMot
sj1mbF6fZjolT6wfcClDnURWJOfXAn8h+bklCCp9IXwjPjg1tei5WGpprFzotnAf
ELmgnCY6PBjB8e9dHUcx1Bf/XAiERZSNpIfa1HaMawqr4Q3EcUQq5ivwuGhiHBX3
Gv6FlVnLGx4ovtkrBRw5qL0ncsGwtMqk6JcHEDUdAoGAApiaWc4o2pSraICGTrbG
0phDqeBG8K8Ve7CZ4G6Uv26DCjaJ/WO0aDtkyCxg/+8y9+0pptKyxhXsCuWv3Gtt
svCUgjW8HFsL+DS5Fgguy0TRTPwTEUX0JTMgJfbBQ1CUcueJ9F4q4j39FYfNAZZQ
XcJOBW3DpsqgvLGvIpLK/6E=
-----END PRIVATE KEY-----`
        };

        // ==========================================
        // âš™ï¸ JWT ç”Ÿæˆç®—æ³•ï¼šå®ç°çœŸæ­£çš„ä¼šè¯éš”ç¦»
        // ==========================================
        async function generateCozeJWT() {
            try {
                // 1. è½¬æ¢ç§é’¥æ ¼å¼
                const privateKey = await jose.importPKCS8(COZE_CONFIG.privateKeyPem, 'RS256');
                
                // 2. å‡†å¤‡ Payloadï¼šè¿™é‡ŒåŠ å…¥éšæœºçš„ session_name å®ç°å¤±å¿†
                const now = Math.floor(Date.now() / 1000);
                const sessionName = 's_' + Date.now() + Math.random().toString(36).substr(2, 6);
                
                const jwt = await new jose.SignJWT({
                    iss: COZE_CONFIG.appId,
                    aud: "api.coze.cn",
                    jti: Math.random().toString(36).substr(2, 32),
                    iat: now,
                    exp: now + 3600,
                    session_name: sessionName // ğŸ”‘ å…³é”®ï¼šè¿™å°±æ˜¯å¤±å¿†çµè¯ï¼
                })
                .setProtectedHeader({ alg: 'RS256', kid: COZE_CONFIG.kid, typ: 'JWT' })
                .sign(privateKey);
                
                console.log("âœ… JWT å·²ç”Ÿæˆï¼Œæ–°ä¼šè¯å¯åŠ¨:", sessionName);
                return jwt;
            } catch (err) {
                console.error("âŒ JWT ç”Ÿæˆå¤±è´¥:", err);
            }
        }

        // ==========================================
        // ğŸš€ åˆå§‹åŒ– SDK
        // ==========================================
        async function initLiDoctor() {
            const firstToken = await generateCozeJWT();
            
            const client = new CozeWebSDK.WebChatClient({
                config: { bot_id: '7608863077597626394' },
                componentProps: { title: 'æåŒ»ç”Ÿæ•°å­—è¯Šå®¤', layout: 'pc' },
                auth: {
                    type: 'token',
                    token: firstToken,
                    onRefreshToken: generateCozeJWT // æ¯æ¬¡ä»¤ç‰Œè¿‡æœŸéƒ½ä¼šç”Ÿæˆæ–°çš„ session_name
                },
                userInfo: { id: 'patient_test', name: 'è®¿å®¢' },
                ui: { asstBtn: { isNeed: false } }
            });

            setTimeout(() => { if (client.showChatBot) client.showChatBot(); }, 1000);
        }

        initLiDoctor();
    </script>
</body>
</html>
